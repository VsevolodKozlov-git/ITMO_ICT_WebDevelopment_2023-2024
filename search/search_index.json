{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#k33421","title":"\u041a\u043e\u0437\u043b\u043e\u0432 \u0412\u0441\u0435\u0432\u043e\u043b\u043e\u0434 \u0414\u0435\u043d\u0438\u0441\u043e\u0432\u0438\u0447, \u0433\u0440\u0443\u043f\u043f\u0430 K33421","text":""},{"location":"lab1/ex1/","title":"\u0423\u043f\u0440\u0430\u0436\u0435\u043d\u0435\u043d\u0438\u0435 1","text":""},{"location":"lab1/ex1/#_1","title":"\u041a\u043e\u0434","text":""},{"location":"lab1/ex1/#_2","title":"\u041a\u043b\u0438\u0435\u043d\u0442\u0430","text":"<pre><code>import socket\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    conn.connect(('127.0.0.1', 14901))\n    conn.send(b'Hello, server')\n    msg_from_server = conn.recv(14000).decode('utf-8')\n    print(msg_from_server)\n    conn.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex1/#_3","title":"\u0421\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>import socket\n\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    conn.bind(('127.0.0.1', 14901))\n    data, client_addr = conn.recvfrom(12000)\n    decoded_data = data.decode('utf-8')\n    print(decoded_data)\n    conn.sendto(b\"Hello, client\", client_addr)\n    conn.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex1/#_4","title":"\u0414\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044b","text":"<p>\u0412\u044b\u0432\u043e\u0434 \u0441\u0435\u0440\u0432\u0435\u0440\u0430</p> <p></p> <p>\u0412\u044b\u0432\u043e\u0434 \u043a\u043b\u0438\u0435\u043d\u0442\u0430</p>"},{"location":"lab1/ex2/","title":"\u0423\u043f\u0440\u0430\u0436\u043d\u0435\u043d\u0438\u0435 2","text":""},{"location":"lab1/ex2/#_1","title":"\u041a\u043e\u0434","text":""},{"location":"lab1/ex2/#_2","title":"\u041a\u043b\u0438\u0435\u043d\u0442\u0430","text":"<pre><code>import socket\nimport pickle\n\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    conn.connect(('127.0.0.1', 14900))\n\n    height = int(input('Height:'))\n    lower_base = int(input('Lower base:'))\n    upper_base = int(input('Upper base:'))\n\n    trap_data = (lower_base, upper_base, height)\n    encoded_trap_data = pickle.dumps(trap_data)\n    conn.send(encoded_trap_data)\n\n    server_response_enc = conn.recv(12000)\n    server_response_dec = server_response_enc.decode('utf-8')\n    print(f'Trapezoid area: {server_response_dec}')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex2/#_3","title":"\u0421\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>\nimport socket\nimport pickle\n\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    conn.bind(('127.0.0.1', 14900))\n    conn.listen(10)\n\n    client_socket, address = conn.accept()\n    encoded_data = client_socket.recv(12000)\n    lower_base, upper_base, height = pickle.loads(encoded_data)\n\n    area = (upper_base + lower_base) / 2 * height\n    area = round(area, 2)\n\n    area_encoded = str(area).encode('utf-8')\n    client_socket.send(area_encoded)\n    conn.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex2/#_4","title":"\u0414\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"<p> \u0427\u0442\u043e \u0432\u0438\u0434\u0438\u0442 \u043a\u043b\u0438\u0435\u043d\u0442</p>"},{"location":"lab1/ex3/","title":"\u0423\u043f\u0440\u0430\u0436\u043d\u0435\u043d\u0438\u0435 3","text":""},{"location":"lab1/ex3/#_1","title":"\u041a\u043e\u0434","text":""},{"location":"lab1/ex3/#_2","title":"\u0421\u0435\u0440\u0432\u0435\u0440","text":"<pre><code>import socket\n\n\ndef get_webpage_response():\n    response_type = 'HTTP/1.0 200 OK\\n'\n    headers = 'Content-Type: text/html\\n\\n'\n    with open('index.html') as f:\n        content = \"\".join(f.readlines())\n\n    response_raw = response_type + headers + content\n    response_encoded = response_raw.encode('utf-8')\n    return response_encoded\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    conn.bind(('127.0.0.1', 14900))\n    conn.listen(10)\n\n    while True:\n        try:\n            client_socket, address = conn.accept()\n            webpage_response = get_webpage_response()\n            client_socket.send(webpage_response)\n        except KeyboardInterrupt:\n            break\n    conn.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex3/#indexhtml","title":"index.html","text":"<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;A Meaningful Page Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\nThe content of the document......\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab1/ex3/#_3","title":"\u0414\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"<p> \u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u043f\u043e\u043b\u0443\u0447\u0438\u043b \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430</p>"},{"location":"lab1/ex4/","title":"\u0423\u043f\u0440\u0430\u0436\u0435\u043d\u0435\u043d\u0438\u0435 4","text":""},{"location":"lab1/ex4/#_1","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f","text":""},{"location":"lab1/ex4/#_2","title":"\u041a\u043b\u0438\u0435\u043d\u0442\u0430","text":"<p>\u041a\u043b\u0438\u0435\u043d\u0442 \u0438\u043c\u0435\u0435\u0442 2 \u043f\u043e\u0442\u043e\u043a\u0430. \u041e\u0434\u0438\u043d \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u0414\u0440\u0443\u0433\u043e\u0439 \u0434\u043b\u044f \u0432\u044b\u0432\u043e\u0434\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439</p> <pre><code>import socket\nimport concurrent.futures\nimport threading\n\nstop_event = threading.Event()\n\n\ndef input_thread(conn: socket.socket):\n    \"\"\"\u041f\u043e\u0442\u043e\u043a \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0434\u0430\u043d\u043d\u044b\u0445\"\"\"\n    while not stop_event.is_set():\n        msg = input()\n        msg_encoded = msg.encode()\n        conn.send(msg_encoded)\n        if msg == 'Bye!':\n            print('Stopped everything')\n            stop_event.set()\n\n\ndef msg_printer_thread(conn: socket.socket):\n    \"\"\"\u041f\u043e\u0442\u043e\u043a \u0434\u043b\u044f \u0432\u044b\u0432\u043e\u0434\u0430 \u0434\u0430\u043d\u043d\u044b\u0445\"\"\"\n    while not stop_event.is_set():\n        msg = conn.recv(13000)\n        print(msg.decode('utf-8'))\n\n\ndef main():\n    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    conn.connect(('127.0.0.1', 14900))\n    with concurrent.futures.ThreadPoolExecutor() as executor:\n        executor.submit(input_thread, conn)\n        executor.submit(msg_printer_thread, conn)\n    conn.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"lab1/ex4/#_3","title":"\u0421\u0435\u0440\u0432\u0435\u0440\u0430","text":"<p>\u0421\u0435\u0440\u0432\u0435\u0440 \u0438\u043c\u0435\u0435\u0442 3 \u043f\u043e\u0442\u043e\u043a\u0430:</p> <ul> <li>\u041f\u043e\u0442\u043e\u043a \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043d\u043e\u0432\u044b\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439</li> <li>\u041f\u043e\u0442\u043e\u043a \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0439 \u0441\u043e\u043e\u0431\u0449\u0435\u0439\u043d\u0438 \u043e\u0442 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f(\u0438\u0445 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e)</li> <li>\u041f\u043e\u0442\u043e\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c</li> </ul> <p>2 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u0430 \u043e\u0431\u0449\u0430\u044f\u044e\u0442\u0441\u044f \u0434\u0440\u0443\u0433 \u0441 \u0434\u0440\u0443\u0433\u043e\u043c \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 <code>msg_queue</code> </p> <pre><code>import socket\n\nfrom queue import Queue\nfrom concurrent import futures\nimport threading\nfrom dataclasses import dataclass\nfrom typing import Dict\n\n\n@dataclass(frozen=True)\nclass Client():\n    \"\"\"\n    \u041e\u0431\u044a\u0435\u043a\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u043f\u043e\u0442\u043e\u043a \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c\n    \"\"\"\n    conn: socket.socket\n    stop_event: threading.Event\n    \"\"\"\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u043e\u0441\u0442\u043e\u043d\u043e\u0432\u043a\u0438 \u043f\u043e\u0442\u043e\u043a\u0430\"\"\"\n\n\nid_client_dict: Dict[int, Client] = {}\nmsg_queue = Queue()\n\n\ndef main_thread():\n    \"\"\"\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043f\u043e\u0442\u043e\u043a, \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435\"\"\"\n    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    conn.bind(('127.0.0.1', 14900))\n    conn.listen(10)\n    new_client_id = 0\n\n    with futures.ThreadPoolExecutor() as executor:\n        executor.submit(sender_thread)\n\n        while True:\n            client_conn, address = conn.accept()\n            client_conn.send(f'Server: you have received id {new_client_id}'.encode('utf-8'))\n            client = Client(client_conn, threading.Event())\n            id_client_dict[new_client_id] = client\n            executor.submit(client_thread, client, new_client_id)\n            new_client_id += 1\n\n\ndef client_thread(client: Client, _id):\n    \"\"\"\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u043f\u043e\u0441\u0442\u0443\u043f\u0430\u044e\u0449\u0438\u0439 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043e\u0442\u043a\u043b\u0438\u0435\u043d\u0442\u0430\"\"\"\n    while not client.stop_event.is_set():\n        client_msg = client.conn.recv(15000).decode('utf-8')\n        msg_queue.put((client_msg, _id))\n\n\ndef sender_thread():\n    \"\"\"\u0420\u0430\u0441\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u0438\"\"\"\n    while True:\n        msg, sender_id = msg_queue.get()\n\n        for _id, client in id_client_dict.items():\n            if sender_id != _id:\n                client.conn.send(f'{sender_id}:{msg}'.encode())\n        # \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0432\u044b\u0445\u043e\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u0437 \u0447\u0430\u0442\u0430\n        if msg == 'Bye!':\n            sender_client = id_client_dict[sender_id]\n            sender_client.stop_event.set()\n            del id_client_dict[sender_id]\n\n\nif __name__ == '__main__':\n    main_thread()\n</code></pre>"},{"location":"lab1/ex4/#_4","title":"\u0414\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"<p>\u0414\u043b\u044f \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u044f \u0441\u043e\u0437\u0434\u0430\u043c 4 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0447\u0430\u0442\u0435</p> <p></p> <p>\u041a\u0430\u043a \u0432\u0438\u0434\u0438\u0442 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 id=0</p> <p></p> <p>\u041a\u0430\u043a \u0432\u0438\u0434\u0438\u0442 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 id=1</p> <p></p> <p>\u041a\u0430\u043a \u0432\u0438\u0434\u0438\u0442 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 id=2</p>"},{"location":"lab1/ex5/","title":"\u0423\u043f\u0440\u0430\u0436\u043d\u0435\u043d\u0438\u0435 5","text":""},{"location":"lab1/ex5/#_1","title":"\u041a\u043e\u0434","text":""},{"location":"lab1/ex5/#_2","title":"\u041a\u043e\u0434 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>import socket\nimport logging\nfrom io import BufferedWriter, BufferedReader\nimport email.parser\nimport email.message\nfrom urllib.parse import  parse_qs, urlparse\nfrom dataclasses import dataclass\nfrom typing import List, Tuple\n\n\n\nclass Request:\n    \"\"\"\n    Class containing request data\n    \"\"\"\n    def __init__(self, method, target, version, headers, rfile):\n        self.method = method\n        self.target = target\n        self.version = version\n        self.headers = headers\n        self.rfile = rfile\n\n    @property\n    def url_path(self):\n        return self.url.path\n\n    @property\n    def url_params(self):\n        return parse_qs(self.url.query)\n\n    @property\n    def url(self):\n        return urlparse(self.target)\n\n\nclass ConnWriter:\n    \"\"\"\n    Wrapper around file interface of socket\n    \"\"\"\n    encoding = 'iso-8859-1'\n\n    def __init__(self, wfile: BufferedWriter):\n        self._wfile = wfile\n\n    def encode_and_write(self, s: str):\n        if not s.endswith('\\r\\n'):\n            s += '\\r\\n'\n        encoded = s.encode(self.encoding)\n        self._wfile.write(encoded)\n\n    def write_empty_line(self):\n        self._wfile.write(b'\\r\\n')\n\n    def write_bytes(self, s: bytes):\n        if not s.endswith(b'\\r\\n'):\n            s += b'\\r\\n'\n        self._wfile.write(s)\n\n    def __enter__(self):\n        return self\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        self._wfile.flush()\n        self._wfile.close()\n\n\n@dataclass(frozen=True)\nclass Response:\n    \"\"\"\n    Dataclass from which response created\n    \"\"\"\n    status: int\n    reason: str\n    headers: List[Tuple] = None\n    body: bytes = None\n\n\n@dataclass(frozen=True)\nclass Mark:\n    \"\"\"\n    Dataclass to imitate row in database\n    \"\"\"\n    subject: str\n    mark: int\n\n\nclass MyHTTPServer:\n    \"\"\"\n    Accept requests, generate responses\n    \"\"\"\n    def __init__(self, host, port, server_name):\n        self._host = host\n        self._port = port\n        self._server_name = server_name\n        self.marks: List[Mark] = [Mark('Math', 5), Mark('Programming', 4)]\n        \"\"\"Dict to imitate database. Already packed with some values\"\"\"\n\n\n    def serve_forever(self):\n        \"\"\"\n        Starts server. Main function of a class\n        \"\"\"\n\n        conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        try:\n            conn.bind((self._host, self._port))\n            conn.listen(10)\n            while True:\n                client_conn, client_address = conn.accept()\n                self.serve_client(client_conn)\n        finally:\n            conn.close()\n\n    def serve_client(self, client_conn):\n        \"\"\"\n        Get response from a client and send appropriate response\n        \"\"\"\n        request = self.parse_request(client_conn)\n        response = self.handle_request(request)\n        self.send_response(client_conn, response)\n\n    def parse_request(self, conn):\n        \"\"\"\n        Convert request into Request instance\n        \"\"\"\n        rfile = conn.makefile('rb')\n        method, target, version = self.parse_request_line(rfile)\n        logging.debug(f'request_line: {method} {target} {version}')\n        headers = self.parse_headers(rfile)\n        logging.debug(f'headers:\\n{headers}')\n        self.check_host(headers)\n\n        return Request(method, target, version, headers, rfile)\n\n    def parse_request_line(self, rfile):\n        request_line = rfile.readline().decode('iso-8859-1')\n        request_line = request_line.rstrip('\\r\\n')\n        method, target, version = request_line.split()\n        if version != 'HTTP/1.1':\n            raise Exception('Invalid HTTP version')\n        return method, target, version\n\n    def parse_headers(self, rfile: BufferedReader) -&gt; email.message.Message:\n        headers_list = []\n        while True:\n            line = rfile.readline()\n\n            if line in (b'\\r\\n', b'\\n', b''):\n                break\n            headers_list.append(line)\n        headers_str = b''.join(headers_list).decode('iso-8859-1')\n        return email.parser.Parser().parsestr(headers_str)\n\n    def check_host(self, headers):\n        \"\"\"Is host correct?\"\"\"\n        host = headers.get('Host', '')\n        logging.debug(f'host: {host}')\n        if not host:\n            raise Exception('Request without host')\n        if host not in (self._server_name,\n                        f'{self._host}:{self._port}'):\n            raise Exception('Invalid host')\n\n    def handle_request(self, request:Request) -&gt; Response:\n        \"\"\"Handle different types of request. Even if this request is not supported\"\"\"\n        if request.method == 'GET' and request.url_path == '/':\n            return self.handle_get_mark(request)\n        if request.method == 'POST' and request.url_path =='/update_marks':\n            return self.handle_post_update_marks(request)\n        if request.method == 'GET' and request.url_path == \"/update_marks\":\n            return self.handle_get_update_marks(request)\n        if request.method == 'GET' and request.url_path == '/favicon.ico':\n            return Response(200, 'OK')\n\n        return self.handle_404(request)\n\n    def handle_post_update_marks(self, request: Request):\n        arg_line = request.rfile.readline()\n        arg_line = arg_line.decode('iso-8859-1')\n        parameters = parse_qs(arg_line)\n        if 'mark' not in parameters:\n            raise Exception('No mark in post')\n        if 'subject' not in parameters:\n            raise Exception('No subject in post')\n        mark = parameters['mark'][0]\n        if not mark.isnumeric():\n            raise Exception('Invalid mark')\n        mark = int(mark)\n        subject = parameters['subject'][0]\n        self.marks.append(Mark(subject, mark))\n        return Response(204, 'Created')\n\n    def handle_get_mark(self, request: Request):\n        content_type = 'text/html; charset=utf-8'\n        body = '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;'\n        body += '&lt;table&gt;'\n        for mark in self.marks:\n            body += '&lt;tr&gt;'\n            body += f'&lt;td&gt;{mark.subject}&lt;/td&gt;'\n            body += f'&lt;td&gt;{mark.mark}&lt;/td&gt;'\n            body += '&lt;/tr&gt;'\n        body += '&lt;/table&gt;'\n        body += '&lt;/body&gt;&lt;/html&gt;'\n\n        body = body.encode('utf-8')\n        headers = [('Content-Type', content_type),\n                   ('Content-Length', len(body))]\n        return Response(404, 'Not Found', headers, body)\n\n    def handle_404(self, request: Request):\n        body = '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;404 not found&lt;/h1&gt;&lt;/body&gt;'\n        body = body.encode('utf-8')\n        content_type = 'text/html; charset=utf-8'\n        headers = [('Content-Type', content_type),\n                   ('Content-Length', len(body))]\n        return Response(200, 'OK', headers, body)\n\n\n    def handle_get_update_marks(self, request):\n        with open('update_marks.html') as f:\n            body = ''.join(f.readlines())\n        body = body.encode('utf-8')\n\n        headers = [('Content-Type', 'text/html; charset=utf-8'),\n                   ('Content-Length', len(body))]\n        return Response(200, 'OK', headers, body)\n\n\n    def send_response(self, conn: socket.socket, resp: Response):\n        \"\"\"Convert Response class instance into appropriate test and sends it via socket\"\"\"\n        with ConnWriter(conn.makefile('wb')) as wfile_wrapped:\n            status_line = f'HTTP/1.1  {resp.status} {resp.reason}'\n            wfile_wrapped.encode_and_write(status_line)\n\n            if resp.headers is not None:\n                for key, value in resp.headers:\n                    header_line = f'{key}: {value}'\n                    wfile_wrapped.encode_and_write(header_line)\n            wfile_wrapped.write_empty_line()\n\n            if resp.body is not None:\n                wfile_wrapped.write_bytes(resp.body)\n\n\nif __name__ == '__main__':\n    format = \"%(asctime)s: %(message)s\"\n    logging.basicConfig(format=format, level=logging.INFO,\n                        datefmt=\"%H:%M:%S\")\n    host = '127.0.0.1'\n    port = 14900\n    name = 'example.local'\n    server = MyHTTPServer(host, port, name)\n    server.serve_forever()\n</code></pre>"},{"location":"lab1/ex5/#update_markshtml","title":"\u041a\u043e\u0434 update_marks.html","text":"<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en-GB\"&gt;\n&lt;head&gt;\n  &lt;title&gt;Update marks&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;form action=\"/update_marks\" method=\"post\"&gt;\n    &lt;label&gt;\n        Input mark\n        &lt;input type=\"number\" size=\"3\" id=\"mark\" name=\"mark\"&gt;\n    &lt;/label&gt;\n    &lt;br&gt;\n    &lt;label&gt;\n        Input subject\n        &lt;input type=\"text\" size=\"20\" id=\"subject\" name=\"subject\"&gt;\n    &lt;/label&gt;\n    &lt;div&gt;\n        &lt;input type=\"reset\" value=\"Clear\"&gt;\n        &lt;input type=\"submit\" value=\"Send\"&gt;\n    &lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab1/ex5/#_3","title":"\u0414\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"<p>\u0421\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0434\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445</p> <p></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0446\u0435\u043d\u043e\u043a</p> <p></p> <p>\u041a\u043e\u0440\u043d\u0435\u0432\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043f\u043e\u0441\u043b\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0446\u0435\u043d\u043a\u0438</p> <p></p> <p>\u041f\u0440\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0438 \u043d\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c not found</p>"},{"location":"lab2/forms/","title":"Forms","text":""},{"location":"lab2/forms/#userregisterform","title":"UserRegisterForm","text":"<p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f: * \u041d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u043e\u043b\u044f \u0441\u0434\u0435\u043b\u0430\u043d\u044b \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438 * \u0418\u0437\u043c\u0435\u043d\u0435\u043d \u0432\u0438\u0434\u0436\u0435\u0442 \u0434\u043b\u044f \u0434\u0430\u0442\u044b \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f</p> <pre><code>class UserRegisterForm(UserCreationForm):\n    def __init__(self, *args, **kwargs):\n        super(UserRegisterForm, self).__init__(*args, **kwargs)\n        self.fields['first_name'].required = True\n        self.fields['last_name'].required = True\n        self.fields['passport_number'].required = True\n        self.fields['birth_date'].widget = widgets.DateInput(attrs={'type':'date',\n                                                                    'class': 'form-control'})\n\n    class Meta(UserCreationForm.Meta):\n        model = user\n        fields = ['username',\n                  'first_name',\n                  'last_name',\n                  'email',\n                  'passport_number',\n                  'birth_date',\n                  'password1',\n                  'password2']\n\n</code></pre>"},{"location":"lab2/forms/#reviewform","title":"ReviewForm","text":"<p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u043e\u0442\u0437\u044b\u0432\u0430</p> <pre><code>class ReviewForm(ModelForm):\n    def __init__(self, user_instance, *args, **kwargs):\n        super(ReviewForm, self).__init__(*args, **kwargs)\n        self.update_field_userflights_for_user(user_instance)\n\n    class Meta:\n        model = models.Review\n        fields = ['user_flight', 'text', 'grade']\n\n\n    def update_field_userflights_for_user(self, user_instance):\n        # default value\n        empty_label = ''\n\n        # filter only user's userflights\n        userflights_set = user_instance.userflight_set.get_queryset()\n        userflights_set = userflights_set.filter(approved=True)\n        if not userflights_set:\n            empty_label = '\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u043b\u0435\u0442\u0430'\n        # remove already reviewed flights\n        else:\n            revieved_userflights_pk = [i.user_flight.pk for i in models.Review.objects.all()]\n            userflights_set = userflights_set.exclude(pk__in=revieved_userflights_pk)\n            if not userflights_set:\n                empty_label = '\u0412\u044b \u043e\u0446\u0435\u043d\u0438\u043b\u0438 \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043b\u0435\u0442\u044b'\n\n        self.fields['user_flight'] = forms.ModelChoiceField(\n            queryset=userflights_set,\n            empty_label=empty_label)\n</code></pre>"},{"location":"lab2/forms/#reservationform","title":"ReservationForm","text":"<p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u0440\u0435\u0437\u0435\u0440\u0432\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u0435\u0442\u0430</p> <pre><code>class ReservationForm(ModelForm):\n    def __init__(self, user_instance, flight_instance, *args, **kwargs):\n        super(ModelForm, self).__init__(*args, **kwargs)\n        user_field = self.fields['user']\n        user_field.initial = user_instance\n        user_field.widget = user_field.hidden_widget()\n\n        flight_field = self.fields['flight']\n        flight_field.initial = flight_instance\n        flight_field.widget = flight_field.hidden_widget()\n\n\n    class Meta:\n        model = models.UserFlight\n        fields = ['seat_number',\n                  'user',\n                  'flight']\n</code></pre>"},{"location":"lab2/models/","title":"Models","text":""},{"location":"lab2/models/#models","title":"Models","text":""},{"location":"lab2/models/#flight","title":"Flight","text":"<p>\u041c\u043e\u0434\u0435\u043b\u044c \u043e\u0442\u0432\u0435\u0447\u0430\u044e\u0449\u0430\u044f \u0437\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u043e\u043b\u0435\u0442\u0435 \u0412 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 clean \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u0435\u0439 \u0438 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0434\u0430\u0442\u0430 \u0432\u044b\u043b\u0435\u0442\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u0434\u0430\u0442\u044b \u043f\u0440\u0438\u0431\u044b\u0442\u0438\u044f</p> <pre><code>class Flight(models.Model):\n    flight_number = models.CharField(max_length=10, blank=False)\n    airline = models.CharField(max_length=100, blank=False)\n    departure_place = models.CharField(max_length=100, blank=False)\n    arrival_place = models.CharField(max_length=100, blank=False)\n    departure_time = models.DateTimeField()\n    arrival_time = models.DateTimeField()\n    gate = models.IntegerField(null=True)\n\n    def clean(self):\n        required = [(self.flight_number, 'flight number'),\n                    (self.airline, 'airline'),\n                    (self.departure_place, 'departure place'),\n                    (self.arrival_place,  'arrival place')]\n\n        for field, name in required:\n            if not field:\n                raise ValidationError(f'{name} is empty')\n\n        if self.departure_time &gt;= self.arrival_time:\n            raise ValidationError(f'departure time larger than arrival time')\n\n    def __str__(self):\n        return self.flight_number\n</code></pre>"},{"location":"lab2/models/#user","title":"User","text":"<p>\u0420\u0430\u0441\u0448\u0438\u0440\u044f\u0435\u0442 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044f \u0434\u0430\u0442\u0443 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f, \u043d\u043e\u043c\u0435\u0440 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0430 \u0438 \u043f\u043e\u043b\u0435\u0442\u044b</p> <pre><code>class User(AbstractUser):\n    birth_date = models.DateField(null=True, blank=True)\n    passport_number = models.CharField(max_length=10, null=True, unique=True, blank=True)\n    flights = models.ManyToManyField(Flight, through='UserFlight')\n\n    def __str__(self):\n        return f'{self.get_username()}'\n\n    def get_absolute_url(self):\n        return reverse('aviasales:user_detail', kwargs={'pk': self.pk})\n</code></pre>"},{"location":"lab2/models/#userflight","title":"UserFlight","text":"<p>\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u043e\u0439 \u0430\u0441\u0441\u043e\u0446\u0438\u0430\u0442\u0438\u0432\u043d\u0443\u044e \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0445\u0440\u0430\u043d\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u043e\u043b\u0435\u0442\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f</p> <pre><code>class UserFlight(models.Model):\n    seat_number = models.CharField(max_length=4, blank=False)\n    ticket_number = models.CharField(max_length=10, blank=False)\n    approved = models.BooleanField(default=False)\n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    flight = models.ForeignKey(Flight, on_delete=models.CASCADE)\n\n    def clean(self):\n        required = [(self.seat_number, 'seat number')]\n        for field, name in required:\n            if not field:\n                raise ValidationError(f'{name} is empty')\n\n    def __str__(self):\n        return f'{self.user.get_username()} {self.flight.flight_number}'\n\n    def get_delete_url(self):\n        return reverse('aviasales:userflight_delete', kwargs={'pk': self.pk})\n\n    def get_update_url(self):\n        return reverse('aviasales:userflight_update', kwargs={'pk': self.pk})\n</code></pre>"},{"location":"lab2/models/#review","title":"Review","text":"<p>\u041e\u0442\u0437\u044b\u0432 \u043d\u0430 \u043f\u043e\u043b\u0435\u0442 \u043e\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f</p> <pre><code>class Review(models.Model):\n    user_flight = models.ForeignKey(UserFlight, on_delete=models.CASCADE)\n    text = models.TextField(blank=True)\n    grade = models.IntegerField(validators=[validators.MinValueValidator(0, message='less than 0'),\n                                            validators.MaxValueValidator(10, message='larger than 10')])\n\n    def __str__(self):\n        return f'{self.user_flight}'\n</code></pre>"},{"location":"lab2/urls/","title":"Urls","text":"<pre><code>urlpatterns = [\n    path('user_registration', views.UserRegistration.as_view(), name='user_registration'),\n    path('user_detail/&lt;int:pk&gt;', views.UserDetail.as_view(), name='user_detail'),\n    path('flight_info/&lt;int:flight_pk&gt;', views.FlightInfo.as_view(), name='flight_info'),\n    path('auth_test', views.auth_test, name='auth_test'),\n    path('my_flights', views.MyFlights.as_view(), name='my_flights'),\n    path('userflight_update/&lt;int:pk&gt;', views.UserFlightUpdateView.as_view(), name='userflight_update'),\n    path('userflight_delete/&lt;int:pk&gt;', views.UserFlightDeleteView.as_view(), name='userflight_delete'),\n    path('review_create', views.ReviewCreateView.as_view(), name='review_create'),\n    path('review_list', views.ReviewListView.as_view(), name='review_list'),\n    path('userflight_reservation_list', views.UserFlightsReservationList.as_view(), name='userflight_reservation_list'),\n    path(r'userflight_reservation_form/&lt;int:flight_pk&gt;', views.UserFlightsReservationForm.as_view(), name='userflight_reservation_form')\n]\n</code></pre>"},{"location":"lab2/views/","title":"Views","text":""},{"location":"lab2/views/#userregistration","title":"UserRegistration","text":"<p>url: <code>/aviasales/user_registration</code></p> <p>\u0424\u043e\u0440\u043c\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f</p> <p></p> <pre><code>class UserRegistration(View):\n    template_path = get_template_path('user_registration')\n    form_class = forms.UserRegisterForm\n\n    def get(self, request, *args, **kwargs):\n        form = self.form_class()\n        context = {'form': form}\n        return render(request, self.template_path, context)\n\n    def post(self, request, *args, **kwargs):\n        form = self.form_class(request.POST)\n        if form.is_valid():\n            user = form.save()\n            return redirect(user.get_absolute_url())\n        context = {'form': form}\n        return render(request, self.template_path, context)\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;User registration&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;form method=\"post\"&gt;\n        {%  csrf_token %}\n        {{ form.as_p }}\n        &lt;input type=\"submit\" value=\"submit\"&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#userdetail","title":"UserDetail","text":"<p>url: <code>aviasales/user_detail/&lt;int:pk&gt;</code></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435</p> <p></p> <pre><code>class UserDetail(DetailView):\n    model = user_model\n    template_name = 'aviasales/user_detail.html'\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;{{ object.username }} profile&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;{{ object.username }}&lt;/h1&gt;\n    &lt;ul&gt;\n        &lt;li&gt;\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u0438\u043c\u044f: {{ object.first_name }} {{ object.last_name }}&lt;/li&gt;\n        {% if object.email %}\n            &lt;li&gt;Email: {{ object.email }}&lt;/li&gt;\n        {% endif %}\n        {% if object.birth_date %}\n            &lt;li&gt;\u0414\u0430\u0442\u0430 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f: {{ object.birth_date }}&lt;/li&gt;\n        {% endif %}\n        {% if object.passport_number is not None%}\n            &lt;li&gt;\u041d\u043e\u043c\u0435\u0440 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0430: {{ object.passport_number }}&lt;/li&gt;\n        {% endif %}\n    &lt;/ul&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#flightinfo","title":"FlightInfo","text":"<p>url: <code>aviasales/flight_info/&lt;int:flight_pk&gt;</code></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 \u043e \u0434\u0440\u0443\u0433\u0438\u0445 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430\u0445 \u043f\u043e\u043b\u0435\u0442\u0430</p> <p></p> <pre><code>class FlightInfo(View):\n    template_path = get_template_path('flight_info')\n\n    def get(self, request, flight_pk):\n        user_flights = models.UserFlight.objects.filter(flight__pk=flight_pk,\n                                                        approved=True)\n        context = {'user_flights': user_flights}\n        return render(request, self.template_path, context=context)\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Flight info&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    {% if not user_flights %}\n        &lt;h2&gt;No approved tickets for that flight&lt;/h2&gt;\n    {% else %}\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;th&gt;Ticket number&lt;/th&gt;\n                &lt;th&gt;Seat&lt;/th&gt;\n                &lt;th&gt;Passenger profile&lt;/th&gt;\n            &lt;/tr&gt;\n\n\n            {% for user_flight in user_flights %}\n                &lt;tr&gt;\n                    &lt;td&gt;{{ user_flight.ticket_number }}&lt;/td&gt;\n                    &lt;td&gt;{{ user_flight.seat_number }}&lt;/td&gt;\n                    &lt;td&gt;\n                        &lt;a href=\"{{ user_flight.user.get_absolute_url }}\"&gt;\n                            click\n                        &lt;/a&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n            {% endfor %}\n        &lt;/table&gt;\n    {% endif %}\n\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#userflightsreservationlist","title":"UserFlightsReservationList","text":"<p>url: <code>aviasales/userflight_reservation_list</code></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430, \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u044e\u0449\u0430\u044f \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u043b\u044f \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043f\u043e\u043b\u0435\u0442\u043e\u0432</p> <p></p> <pre><code>class UserFlightsReservationList(LoginRequiredMixin, ListView):\n    model = models.Flight\n    template_name = get_template_path('userflight_reservation_list')\n\n    def get_queryset(self):\n        queryset = super().get_queryset()\n        user = self.request.user\n        reserved_flights_pks = {i.flight.pk for i in user.userflight_set.get_queryset()}\n        queryset = queryset.exclude(pk__in=reserved_flights_pks)\n        return queryset\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Flight reservation&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    {% if not object_list %}\n         &lt;p&gt;No flights you can reserve&lt;/p&gt;\n    {% else %}\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;th&gt;flight number&lt;/th&gt;\n                &lt;th&gt;airline&lt;/th&gt;\n                &lt;th&gt;departure place&lt;/th&gt;\n                &lt;th&gt;arrival_place&lt;/th&gt;\n                &lt;th&gt;departure_time&lt;/th&gt;\n                &lt;th&gt;arrival_tim&lt;/th&gt;\n                &lt;th&gt;gate&lt;/th&gt;\n                &lt;th&gt;reserve&lt;/th&gt;\n            &lt;/tr&gt;\n            {% for obj in object_list %}\n                &lt;tr&gt;\n                    &lt;td&gt;{{ obj.flight_number }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.airline }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.departure_place }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.arrival_place }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.departure_time }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.arrival_time }}&lt;/td&gt;\n                    &lt;td&gt;{{ obj.gate }}&lt;/td&gt;\n                    &lt;td&gt;&lt;a href=\"{% url 'aviasales:userflight_reservation_form' flight_pk=obj.pk %}\"&gt;reserve&lt;/a&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n            {% endfor %}\n        &lt;/table&gt;\n    {% endif %}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#userflightsreservationform","title":"UserFlightsReservationForm","text":"<p>url: <code>aviasales/userflight_reservation_form/&lt;int:flight_pk&gt;</code></p> <p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u0431\u0440\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043f\u043e\u043b\u0435\u0442\u0430</p> <p></p> <pre><code>class UserFlightsReservationForm(LoginRequiredMixin, View):\n    template_path = get_template_path('userflight_reservation_form')\n    form_class = forms.ReservationForm\n\n    last_get_flight = None\n\n    def get(self, request, flight_pk, *args, **kwargs):\n        user = request.user\n        flight = models.Flight.objects.get(pk=flight_pk)\n        self.last_get_flight = flight\n        form = self.form_class(user, flight)\n        context = {'form': form}\n        return render(request, self.template_path, context)\n\n    def post(self, request, flight_pk, *args, **kwargs):\n        user = request.user\n        flight = models.Flight.objects.get(pk=flight_pk)\n        form = self.form_class(user, flight, request.POST)\n        if form.is_valid():\n            form.save()\n            return redirect(reverse('aviasales:userflight_reservation_list'))\n        context = {'form': form}\n        return render(request, self.template_path, context)\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Reservation form&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n     &lt;form method=\"POST\"&gt;\n        {% csrf_token %}\n        {{ form.as_p }}\n        &lt;input type=\"submit\" value=\"Send\"&gt;\n     &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#myflights","title":"MyFlights","text":"<p>url: <code>/aviasales/my_flights</code></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0442\u044c, \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u0435\u0442\u044b</p> <p></p> <pre><code>class MyFlights(LoginRequiredMixin, View):\n\n    template_path = get_template_path('my_flights')\n\n    def get(self, request):\n        user = request.user\n        user_flights = models.UserFlight.objects.filter(user__pk=user.pk, approved=True)\n        context = {'user_flights': user_flights}\n        return render(request, self.template_path, context)\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;My Flights&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    {% if not user_flights %}\n        You have no flights\n    {% else %}\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;th&gt;Flight number&lt;/th&gt;\n                &lt;th&gt;Ticker number&lt;/th&gt;\n                &lt;th&gt;Seat number&lt;/th&gt;\n                &lt;th&gt;Change&lt;/th&gt;\n                &lt;th&gt;Delete&lt;/th&gt;\n            &lt;/tr&gt;\n\n            {% for user_flight in user_flights %}\n                &lt;tr&gt;\n                    &lt;td&gt;{{ user_flight.flight.flight_number }}&lt;/td&gt;\n                    &lt;td&gt;{{ user_flight.ticket_number }}&lt;/td&gt;\n                    &lt;td&gt;{{ user_flight.seat_number }}&lt;/td&gt;\n                    &lt;td&gt;\n                        &lt;a href=\"{{ user_flight.get_update_url }}\"&gt;\n                            Update\n                        &lt;/a&gt;\n                    &lt;/td&gt;\n                    &lt;td&gt;\n                        &lt;a href=\"{{ user_flight.get_delete_url }}\"&gt;\n                            Delete\n                        &lt;/a&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n            {% endfor %}\n        &lt;/table&gt;\n\n    {% endif %}\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#userflightupdateview","title":"UserFlightUpdateView","text":"<p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0442\u0430</p> <p>url: <code>aviasales/userflight_update/&lt;int:pk&gt;</code></p> <pre><code>class UserFlightUpdateView(UserPassesTestMixin, UpdateView):\n    model = models.UserFlight\n    fields = ['seat_number']\n    success_url = reverse_lazy('aviasales:my_flights')\n    def test_func(self):\n        userflight_url_pk = self.kwargs[self.pk_url_kwarg]\n        user = self.request.user\n        try:\n            user.userflight_set.get(pk=userflight_url_pk, approved=True)\n            return True\n        except models.UserFlight.DoesNotExist:\n            return False\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;User Flight Form&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;form method=\"POST\"&gt;\n        {% csrf_token %}\n        {{ form.as_p }}\n        &lt;input type=\"submit\" value=\"Send\"&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#userflightdeleteview","title":"UserFlightDeleteView","text":"<p>url: <code>aviasales/userflight_delete/&lt;int:pk&gt;</code></p> <p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0440\u0435\u0437\u0435\u0440\u0432\u0430\u0446\u0438\u0438 \u043d\u0430 \u043f\u043e\u043b\u0435\u0442</p> <p></p> <pre><code>class UserFlightDeleteView(UserPassesTestMixin, DeleteView):\n    model = models.UserFlight\n    success_url = reverse_lazy('aviasales:my_flights')\n\n    def test_func(self):\n        userflight_url_pk = self.kwargs[self.pk_url_kwarg]\n        user = self.request.user\n        try:\n            user.userflight_set.get(pk=userflight_url_pk, approved=True)\n            return True\n        except models.UserFlight.DoesNotExist:\n            return False\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Confirm user flight delete&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h2&gt;Delete?&lt;/h2&gt;\n    &lt;form method=\"post\"&gt;\n        {% csrf_token %}\n        &lt;input type=\"submit\" value=\"Yes\"&gt;\n    &lt;/form&gt;\n\n    &lt;a href=\"{% url 'aviasales:my_flights' %}\"&gt;Return to my flights page&lt;/a&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#reviewcreateview","title":"ReviewCreateView","text":"<p>url: <code>aviasales/review_create</code></p> <p>\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u043e\u0442\u0437\u044b\u0432\u0430 \u043d\u0430 \u043f\u043e\u043b\u0435\u0442</p> <p></p> <pre><code>class ReviewCreateView(LoginRequiredMixin, View):\n    template_path = get_template_path('review_form')\n    form_class = forms.ReviewForm\n\n    def get(self, request, *args, **kwargs):\n        user = request.user\n        form = self.form_class(user)\n        context = {'form': form}\n        return render(request, self.template_path, context)\n\n    def post(self, request, *args, **kwargs):\n        user = request.user\n        form = self.form_class(user, request.POST)\n        if form.is_valid():\n            form.save()\n            return redirect(reverse('aviasales:review_create'))\n        context = {'form': form}\n        return render(request, self.template_path, context)\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Add review&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;form method=\"post\"&gt;\n        {% csrf_token %}\n        {{ form.as_p }}\n        &lt;input type=\"submit\" value=\"Add\"&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"lab2/views/#reviewlistview","title":"ReviewListView","text":"<p>url: <code>aviasales/review_list</code></p> <p>\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u043e\u0442\u0437\u044b\u0432\u0430\u043c\u0438</p> <p></p> <pre><code>class ReviewListView(ListView):\n    model = models.Review\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Review list&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n        {% for obj in object_list %}\n            &lt;h2&gt;&lt;a href=\"{{ obj.user_flight.user.get_absolute_url }}\"&gt;\n                {{  obj.user_flight.user.get_username }}\n            &lt;/a&gt;&lt;/h2&gt;\n            &lt;p&gt;Flight number: {{ obj.user_flight.flight.flight_number }}&lt;/p&gt;\n            &lt;p&gt;Grade:{{ obj.grade }}&lt;/p&gt;\n            &lt;p&gt;Review:{{ obj.text }}&lt;/p&gt;\n        {% empty %}\n            &lt;p&gt;no reviews&lt;/p&gt;\n        {% endfor %}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"}]}